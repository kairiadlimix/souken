# ローカル実行手順

## 前提条件

- Python 3.9以上がインストールされていること
- 必要な依存パッケージがインストールされていること

## セットアップ

### 1. プロジェクトディレクトリに移動

```bash
cd /Users/kairi.oshima/souken
```

**重要**: 必ずプロジェクトルート（`souken`ディレクトリ）に移動してから実行してください。

### 2. 依存パッケージのインストール

```bash
# macOS/Linuxの場合
pip3 install -r requirements.txt
# または
python3 -m pip install -r requirements.txt

# Windowsの場合
pip install -r requirements.txt
```

### 3. サーバーの起動

#### 方法1: run_local.pyを使用（推奨）

```bash
# プロジェクトルートから実行
python3 run_local.py
```

#### 方法2: uvicornを直接使用

```bash
python3 -m uvicorn api.index:app --reload --host 0.0.0.0 --port 8000
```

### 3. 動作確認

サーバーが起動したら、以下のURLにアクセスして確認できます：

- **APIルート**: http://localhost:8000/
- **ヘルスチェック**: http://localhost:8000/api/health
- **APIドキュメント（Swagger UI）**: http://localhost:8000/docs
- **APIドキュメント（ReDoc）**: http://localhost:8000/redoc

## APIの使用方法

### ヘルスチェック

```bash
curl http://localhost:8000/api/health
```

### 図面をアップロードしてチェック

```bash
curl -X POST "http://localhost:8000/api/v1/check" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@【仮実施図】藤原台Ⅲ25号地0911(書き込み有).pdf"
```

### チェック項目一覧を取得

```bash
curl http://localhost:8000/api/v1/check-items
```

## ブラウザでの確認

1. http://localhost:8000/docs にアクセス
2. Swagger UIが表示されます
3. 各エンドポイントを試すことができます
4. 「Try it out」ボタンをクリックして、実際にAPIを呼び出せます

## トラブルシューティング

### ポートが既に使用されている場合

```bash
# 別のポートで起動
uvicorn api.index:app --reload --host 0.0.0.0 --port 8001
```

### モジュールが見つからないエラー

```bash
# プロジェクトルートから実行していることを確認
cd /Users/kairi.oshima/souken
python3 run_local.py
```

### 依存パッケージのエラー

```bash
# 仮想環境を作成してからインストール（推奨）
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# または
venv\Scripts\activate  # Windows
pip3 install -r requirements.txt  # macOS/Linux
# または
pip install -r requirements.txt  # Windows
```

## 開発時の便利な機能

### 自動リロード

`run_local.py`や`--reload`オプションを使用すると、コードを変更すると自動的にサーバーが再起動されます。

### ログレベル

```bash
# より詳細なログを表示
python3 -m uvicorn api.index:app --reload --log-level debug
```

## 次のステップ

- APIドキュメントを確認して、各エンドポイントの使用方法を理解する
- 実際の図面ファイルでテストする
- 必要に応じてコードを修正して、自動リロードで動作確認する

