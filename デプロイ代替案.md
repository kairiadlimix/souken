# 図面チェックAIシステム - デプロイ代替案

## 現状の問題

VercelのPython Serverless Functionsは、FastAPIのようなASGIアプリケーションを直接サポートしていません。Vercelの内部コードが`BaseHTTPRequestHandler`のサブクラスを期待しているため、FastAPIアプリケーションをデプロイすることができません。

## 推奨される代替案

### 1. Railway（最推奨）

**特徴**:
- FastAPIを直接サポート
- 簡単なデプロイ（GitHub連携）
- 無料プランあり（$5/月のクレジット）
- 環境変数の簡単な管理
- ログの確認が容易

**デプロイ手順**:
1. https://railway.app にアカウント作成
2. GitHubリポジトリを接続
3. プロジェクトを選択
4. 自動的にデプロイ開始
5. 環境変数を設定（必要に応じて）

**設定ファイル**:
- `Procfile`を作成（オプション）:
  ```
  web: uvicorn api.index:app --host 0.0.0.0 --port $PORT
  ```

### 2. Render

**特徴**:
- FastAPIを直接サポート
- 簡単なデプロイ（GitHub連携）
- 無料プランあり（スリープあり）
- 環境変数の簡単な管理

**デプロイ手順**:
1. https://render.com にアカウント作成
2. GitHubリポジトリを接続
3. 「New Web Service」を選択
4. 設定:
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `uvicorn api.index:app --host 0.0.0.0 --port $PORT`
5. デプロイ開始

**設定ファイル**:
- `render.yaml`を作成（オプション）:
  ```yaml
  services:
    - type: web
      name: souken-api
      env: python
      buildCommand: pip install -r requirements.txt
      startCommand: uvicorn api.index:app --host 0.0.0.0 --port $PORT
  ```

### 3. Fly.io

**特徴**:
- FastAPIを直接サポート
- グローバルデプロイ
- 無料プランあり（3つのVM）
- コンテナベース

**デプロイ手順**:
1. https://fly.io にアカウント作成
2. Fly CLIをインストール: `curl -L https://fly.io/install.sh | sh`
3. ログイン: `fly auth login`
4. アプリを作成: `fly launch`
5. デプロイ: `fly deploy`

**設定ファイル**:
- `Dockerfile`を作成:
  ```dockerfile
  FROM python:3.11-slim
  
  WORKDIR /app
  
  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt
  
  COPY . .
  
  EXPOSE 8000
  
  CMD ["uvicorn", "api.index:app", "--host", "0.0.0.0", "--port", "8000"]
  ```

### 4. AWS Lambda + API Gateway

**特徴**:
- Mangumを使用してFastAPIをデプロイ
- スケーラブル
- 従量課金
- 無料枠あり

**デプロイ手順**:
1. AWSアカウントを作成
2. Serverless FrameworkまたはAWS SAMを使用
3. Mangumを使用してFastAPIをラップ
4. デプロイ

**設定ファイル**:
- `serverless.yml`を作成:
  ```yaml
  service: souken-api
  
  provider:
    name: aws
    runtime: python3.11
  
  functions:
    api:
      handler: api.index.handler
      events:
        - http:
            path: /{proxy+}
            method: ANY
        - http:
            path: /
            method: ANY
  ```

### 5. Google Cloud Run

**特徴**:
- FastAPIを直接サポート
- コンテナベース
- 従量課金
- 無料枠あり

**デプロイ手順**:
1. Google Cloudアカウントを作成
2. Cloud Run APIを有効化
3. Dockerfileを作成
4. デプロイ: `gcloud run deploy`

## 比較表

| プラットフォーム | 難易度 | 無料プラン | FastAPIサポート | 推奨度 |
|----------------|--------|-----------|----------------|--------|
| Railway | ⭐⭐ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Render | ⭐⭐ | ✅ | ✅ | ⭐⭐⭐⭐ |
| Fly.io | ⭐⭐⭐ | ✅ | ✅ | ⭐⭐⭐⭐ |
| AWS Lambda | ⭐⭐⭐⭐ | ✅ | ⚠️ (Mangum必要) | ⭐⭐⭐ |
| Cloud Run | ⭐⭐⭐⭐ | ✅ | ✅ | ⭐⭐⭐ |

## 推奨アプローチ

### 短期（すぐにデプロイしたい場合）
**Railway**を推奨します：
- 最も簡単
- GitHub連携で自動デプロイ
- 無料プランあり
- FastAPIを直接サポート

### 長期（本番環境を構築する場合）
**Render**または**Fly.io**を推奨します：
- より安定したインフラ
- スケーラビリティ
- 本番環境に適している

## 次のステップ

1. **Railwayで試す**（推奨）
   - 最も簡単で早い
   - 無料プランで試せる

2. **Renderで試す**
   - Railwayと同様に簡単
   - 無料プランあり

3. **必要に応じて他のプラットフォームを検討**

## 注意事項

- どのプラットフォームでも、`requirements.txt`に必要なパッケージが含まれていることを確認
- 環境変数が必要な場合は、各プラットフォームの設定で追加
- PDFファイルのアップロードサイズ制限を確認（各プラットフォームで異なる）

